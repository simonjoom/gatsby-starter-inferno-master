!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("inferno"),require("stream")):"function"==typeof define&&define.amd?define(["exports","inferno","stream"],t):t((e.Inferno=e.Inferno||{},e.Inferno.Server=e.Inferno.Server||{}),e.Inferno,e.stream)}(this,function(e,_,t){"use strict";var r="a runtime error occured! Use Inferno in development environment to find the error.";function D(e){return C(e)||R(e)}function N(e){return R(e)||!1===e||I(e)||C(e)}function w(e){return"function"==typeof e}function B(e){return"string"==typeof e}function M(e){return"number"==typeof e}function R(e){return null===e}function I(e){return!0===e}function C(e){return void 0===e}function E(e){throw e||(e=r),new Error("Inferno Error: "+e)}function V(e,t){var r={};if(e)for(var n in e)r[n]=e[n];if(t)for(var o in t)r[o]=t[o];return r}function A(e){if(B(e))return e;var t,r="";for(var n in e){var o=e[n];("string"==(t=typeof o)||"number"===t)&&(r+=n+":"+o+";")}return r}var u=new RegExp(/["'&<>]/);function O(e){if(!u.test(e))return e;var t,r="",n="",o=0;for(t=0;t<e.length;t++){switch(e.charCodeAt(t)){case 34:n="&quot;";break;case 39:n="&#039;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}o<t&&(r+=e.slice(o,t)),r+=n,o=t+1}return r+e.slice(o,t)}var n=new RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),o={},s={};function j(e){return void 0!==s[e]||void 0===o[e]&&(n.test(e)?s[e]=!0:!(o[e]=!0))}var W=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]);function J(e,t,r){return e.constructor.getDerivedStateFromProps?V(r,e.constructor.getDerivedStateFromProps(t,r)):r}function i(e){return function e(t,r,n){var o=t.flags,u=t.type,s=t.props||_.EMPTY_OBJ,i=t.children;if(0!=(14&o)){if(4&o){var a,c=new u(s,n),l=Boolean(u.getDerivedStateFromProps);if(c.$BS=!1,c.$SSR=!0,w(c.getChildContext)&&(a=c.getChildContext()),a=D(a)?n:V(n,a),c.props===_.EMPTY_OBJ&&(c.props=s),c.context=n,!l&&w(c.componentWillMount)&&(c.$BR=!0,c.componentWillMount(),c.$BR=!1,c.$PSS)){var d=c.state,h=c.$PS;if(null===d)c.state=h;else for(var f in h)d[f]=h[f];c.$PSS=!1,c.$PS=null}l&&(c.state=J(c,s,c.state));var p=c.render(s,c.state,c.context);return N(p)?"\x3c!--!--\x3e":B(p)?O(p):M(p)?p+"":e(p,t,a)}var v=u(s,n);return N(v)?"\x3c!--!--\x3e":B(v)?O(v):M(v)?v+"":e(v,t,n)}if(0!=(481&o)){var m,S="<"+u,y=W.has(u),F=t.className;if(B(F)?S+=' class="'+O(F)+'"':M(F)&&(S+=' class="'+F+'"'),!R(s)){for(var g in s){var T=s[g];switch(g){case"dangerouslySetInnerHTML":m=T.__html;break;case"style":D(s.style)||(S+=' style="'+A(s.style)+'"');break;case"children":case"className":break;case"defaultValue":s.value||(S+=' value="'+(B(T)?O(T):T)+'"');break;case"defaultChecked":s.checked||(S+=' checked="'+T+'"');break;default:j(g)&&(B(T)?S+=" "+g+'="'+O(T)+'"':M(T)?S+=" "+g+'="'+T+'"':I(T)&&(S+=" "+g))}}"option"===u&&void 0!==s.value&&s.value===r.props.value&&(S+=" selected")}if(y)S+=">";else{S+=">";var x=t.childFlags;if(2===x)S+=e(i,t,n);else if(12&x)for(var Q=0,b=i.length;Q<b;Q++)S+=e(i[Q],t,n);else 16===x?S+=""===i?" ":O(i):m&&(S+=m);y||(S+="</"+u+">")}if(String(u).match(/[\s\n\/='"\0<>]/))throw S;return S}if(0!=(16&o))return""===i?" ":O(i);if(0!=(8192&o)){var k=t.childFlags;if(2===k)return"\x3c!--!--\x3e";if(12&k){for(var P="",C=0,$=i.length;C<$;C++)P+=e(i[C],t,n);return P}}else E();return""}(e,{},{})}var a=function(t){function e(e){t.call(this),this.collector=[Infinity],this.promises=[],this.pushQueue=this.pushQueue.bind(this),e&&this.renderVNodeToQueue(e,null,null)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._read=function(){setTimeout(this.pushQueue,0)},e.prototype.addToQueue=function(e,t){if(D(t))"string"==typeof e&&this.collector.length-1==0?this.push(e):"string"==typeof e&&"string"==typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var r=this.promises[t].length-1;"string"==typeof this.promises[t][r]&&"string"==typeof e?this.promises[t][r]+=e:this.promises[t].push(e)}},e.prototype.pushQueue=function(){var e=this.collector[0];if("string"==typeof e)this.push(e),this.collector.shift();else if(e&&("object"==typeof e||w(e))&&w(e.then)){var r=this;e.then(function(e){var t;(t=r.collector).splice.apply(t,[0,1].concat(r.promises[e])),r.promises[e]=null,setTimeout(r.pushQueue,0)}),this.collector[0]=null}else Infinity===e&&this.emit("end")},e.prototype.renderVNodeToQueue=function(e,t,r){var n=this,o=e.flags,u=e.type,s=e.props||_.EMPTY_OBJ,i=e.children;if(0<(14&o))if(4&o){var a,c=new u(s,t),l=Boolean(u.getDerivedStateFromProps);if(c.$BS=!1,c.$SSR=!0,C(c.getChildContext)||(a=c.getChildContext()),D(a)||(t=V(t,a)),c.props===_.EMPTY_OBJ&&(c.props=s),c.context=t,!l&&w(c.componentWillMount)){if(c.$BR=!0,c.componentWillMount(),c.$PSS){var d=c.state,h=c.$PS;if(null===d)c.state=h;else for(var f in h)d[f]=h[f];c.$PSS=!1,c.$PS=null}c.$BR=!1}if(w(c.getInitialProps)){var p=c.getInitialProps(c.props,c.context);if(p){if(Promise.resolve(p)===p){var v=this.promises.push([])-1;return void this.addToQueue(p.then(function(e){c.$PSS=!1,"object"==typeof e&&(c.props=V(c.props,e));var t=c.render(c.props,c.state,c.context);return N(t)?n.addToQueue("\x3c!--!--\x3e",v):B(t)?n.addToQueue(O(t),v):M(t)?n.addToQueue(t+"",v):n.renderVNodeToQueue(t,c.context,v),setTimeout(n.pushQueue,0),v}),r)}c.props=V(c.props,p)}}l&&(c.state=J(c,s,c.state));var m=c.render(c.props,c.state,c.context);c.$PSS=!1,N(m)?this.addToQueue("\x3c!--!--\x3e",r):B(m)?this.addToQueue(O(m),r):M(m)?this.addToQueue(m+"",r):this.renderVNodeToQueue(m,t,r)}else{var S=u(s,t);N(S)?this.addToQueue("\x3c!--!--\x3e",r):B(S)?this.addToQueue(O(S),r):M(S)?this.addToQueue(S+"",r):this.renderVNodeToQueue(S,t,r)}else if(0<(481&o)){var y,F="<"+u,g=W.has(u),T=e.className;if(B(T)?F+=' class="'+O(T)+'"':M(T)&&(F+=' class="'+T+'"'),!R(s))for(var x in s){var Q=s[x];switch(x){case"dangerouslySetInnerHTML":y=Q.__html;break;case"style":D(s.style)||(F+=' style="'+A(s.style)+'"');break;case"children":case"className":break;case"defaultValue":s.value||(F+=' value="'+(B(Q)?O(Q):Q)+'"');break;case"defaultChecked":s.checked||(F+=' checked="'+Q+'"');break;default:j(x)&&(B(Q)?F+=" "+x+'="'+O(Q)+'"':M(Q)?F+=" "+x+'="'+Q+'"':I(Q)&&(F+=" "+x))}}if(F+=">",String(u).match(/[\s\n\/='"\0<>]/))throw F;if(g)this.addToQueue(F,r);else{var b=e.childFlags;if(2===b)return this.addToQueue(F,r),this.renderVNodeToQueue(i,t,r),void this.addToQueue("</"+u+">",r);if(16===b)return this.addToQueue(F,r),this.addToQueue(""===i?" ":O(i+""),r),void this.addToQueue("</"+u+">",r);if(12&b){this.addToQueue(F,r);for(var k=0,P=i.length;k<P;k++)n.renderVNodeToQueue(i[k],t,r);return void this.addToQueue("</"+u+">",r)}if(y)return void this.addToQueue(F+y+"</"+u+">",r);g||this.addToQueue(F+"</"+u+">",r)}}else 0<(16&o)?this.addToQueue(""===i?" ":O(i),r):E()},e}(t.Readable);function c(e){return new a(e)}var l=Promise.resolve(),d=function(t){function e(e){t.call(this),this.started=!1,this.initNode=e}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype._read=function(){var t=this;this.started||(this.started=!0,l.then(function(){return t.renderNode(t.initNode,null)}).then(function(){t.push(null)}).catch(function(e){t.emit("error",e)}))},e.prototype.renderNode=function(e,t){var r=e.flags;return 0<(14&r)?this.renderComponent(e,t,4&r):0<(481&r)?this.renderElement(e,t):this.renderText(e)},e.prototype.renderComponent=function(e,o,t){var u=this,r=e.type,s=e.props;if(!t){var n=r(s,o);return N(n)?this.push("\x3c!--!--\x3e"):B(n)?this.push(O(n)):M(n)?this.push(n+""):this.renderNode(n,o)}var i,a=new r(s,o),c=Boolean(r.getDerivedStateFromProps);return a.$BS=!1,a.$SSR=!0,w(a.getChildContext)&&(i=a.getChildContext()),D(i)||(o=V(o,i)),a.context=o,a.$BR=!0,Promise.resolve(!c&&a.componentWillMount&&a.componentWillMount()).then(function(){if(a.$PSS){var e=a.state,t=a.$PS;if(null===e)a.state=t;else for(var r in t)e[r]=t[r];a.$PSS=!1,a.$PS=null}a.$BR=!1,c&&(a.state=J(a,s,a.state));var n=a.render(a.props,a.state,a.context);return a.$PSS=!1,N(n)?u.push("\x3c!--!--\x3e"):B(n)?u.push(O(n)):M(n)?u.push(n+""):u.renderNode(n,o)})},e.prototype.renderChildren=function(e,r,t){var n=this;return 2===t?this.renderNode(e,r):16===t?this.push(""===e?" ":O(e+"")):12&t?e.reduce(function(e,t){return e.then(function(){return Promise.resolve(n.renderNode(t,r)).then(function(){return!!(16&t.flags)})})},Promise.resolve(!1)):void 0},e.prototype.renderText=function(e){this.push(""===e.children?" ":O(e.children))},e.prototype.renderElement=function(e,t){var r,n=this,o=e.type,u=e.props,s="<"+o,i=W.has(o),a=e.className;if(B(a)?s+=' class="'+O(a)+'"':M(a)&&(s+=' class="'+a+'"'),!R(u))for(var c in u){var l=u[c];switch(c){case"dangerouslySetInnerHTML":r=l.__html;break;case"style":D(u.style)||(s+=' style="'+A(u.style)+'"');break;case"children":case"className":break;case"defaultValue":u.value||(s+=' value="'+(B(l)?O(l):l)+'"');break;case"defaultChecked":u.checked||(s+=' checked="'+l+'"');break;default:if(j(c)){B(l)?s+=" "+c+'="'+O(l)+'"':M(l)?s+=" "+c+'="'+l+'"':I(l)&&(s+=" "+c);break}}}if(s+=">",this.push(s),String(o).match(/[\s\n\/='"\0<>]/))throw s;if(!i){if(r)return this.push(r),void this.push("</"+o+">");var d=e.childFlags;if(1!==d)return Promise.resolve(this.renderChildren(e.children,t,d)).then(function(){n.push("</"+o+">")});this.push("</"+o+">")}},e}(t.Readable);function h(e){return new d(e)}e.RenderQueueStream=a,e.RenderStream=d,e.renderToStaticMarkup=i,e.renderToString=i,e.streamAsStaticMarkup=h,e.streamAsString=h,e.streamQueueAsStaticMarkup=c,e.streamQueueAsString=c,Object.defineProperty(e,"__esModule",{value:!0})});
